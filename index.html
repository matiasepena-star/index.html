<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>Mi Biblioteca de Dibujos</title>

<style>
:root{
  --bg:#0f1115;
  --stroke:rgba(255,255,255,.12);
  --text:#e8ecf6;
  --muted:rgba(232,236,246,.68);
  --brand:#7aa2ff;
  --danger:#ff5b6b;
  --card:rgba(255,255,255,.04);
  --r:18px;
  --shadow:0 18px 55px rgba(0,0,0,.55);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: radial-gradient(900px 600px at 20% -10%, rgba(122,162,255,.18), transparent 55%),
              radial-gradient(900px 600px at 120% 0%, rgba(68,208,123,.12), transparent 55%),
              var(--bg);
  color:var(--text);
}
.wrap{max-width:1050px;margin:0 auto;padding:16px 14px 90px}

.top{
  display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
  margin-bottom:8px;
}
h1{margin:0;font-size:22px}
p{margin:6px 0 0;color:var(--muted);line-height:1.35;font-size:14px}
.badge{
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.04);
  padding:8px 10px; border-radius:999px;
  color:var(--muted); font-size:12px; white-space:nowrap;
}

.actions{
  display:flex; gap:10px; flex-wrap:wrap;
  margin:14px 0 14px;
}
.btn{
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.06);
  color:var(--text);
  padding:12px 14px;
  border-radius:14px;
  cursor:pointer;
  font-weight:800;
  display:inline-flex;
  gap:10px;
  align-items:center;
}
.btn.primary{
  background:linear-gradient(135deg, rgba(122,162,255,.95), rgba(122,162,255,.70));
  color:#0b0d12;
  border-color:rgba(0,0,0,.15);
}
.btn.danger{
  background:rgba(255,91,107,.14);
  border-color:rgba(255,91,107,.35);
  color:#ffd7dc;
}
.btn:active{ transform: translateY(1px) scale(.99); }

.grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap:12px;
}
@media (min-width:720px){
  .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); gap:14px; }
}
.card{
  background:var(--card);
  border:1px solid var(--stroke);
  border-radius:var(--r);
  overflow:hidden;
  box-shadow:0 10px 28px rgba(0,0,0,.25);
}
.thumb{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  display:block;
  background:#0b0d12;
  cursor:pointer;
}
.meta{
  padding:10px 10px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.title{
  font-size:13px;
  margin:0;
  color:var(--muted);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  max-width:68%;
}
.smallbtn{
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.06);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  cursor:pointer;
  font-weight:800;
}
.smallbtn.del{
  border-color:rgba(255,91,107,.35);
  background:rgba(255,91,107,.12);
  color:#ffd7dc;
}
.smallbtn:active{ transform: translateY(1px) scale(.99); }

.empty{
  padding:18px 14px;
  border:1px dashed rgba(255,255,255,.18);
  border-radius:16px;
  color:var(--muted);
  background:rgba(0,0,0,.18);
  line-height:1.35;
  font-size:14px;
}

/* Modal */
.modal{
  position:fixed; inset:0;
  background:rgba(0,0,0,.72);
  display:none;
  align-items:center;
  justify-content:center;
  padding:16px;
  z-index:999;
}
.modal.open{display:flex}
.modalCard{
  width:min(980px, 100%);
  background:rgba(20,24,34,.95);
  border:1px solid rgba(255,255,255,.14);
  border-radius:20px;
  overflow:hidden;
  box-shadow:var(--shadow);
}
.modalTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px;
  border-bottom:1px solid rgba(255,255,255,.10);
}
.modalTop .t{
  font-weight:900;
  font-size:14px;
  color:var(--text);
}
.closeBtn{
  border:1px solid rgba(255,255,255,.16);
  background:rgba(255,255,255,.06);
  color:var(--text);
  border-radius:12px;
  padding:8px 10px;
  cursor:pointer;
  font-weight:900;
}
.closeBtn:active{ transform: scale(.99); }
.big{
  width:100%;
  height:auto;
  display:block;
  max-height: 78vh;
  object-fit: contain;
  background:#0b0d12;
}
</style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>üé® Mi Biblioteca de Dibujos</h1>
        <p>Agregar dibujo ‚Üí sacar foto ‚Üí queda guardado en la app.</p>
      </div>
      <div class="badge" id="count">0 dibujos</div>
    </div>

    <div class="actions">
      <button class="btn primary" id="addBtn">üì∑ Agregar dibujo</button>
      <button class="btn" id="exportBtn">üì¶ Exportar</button>
      <button class="btn danger" id="clearBtn">üóë Borrar todo</button>
    </div>

    <div id="empty" class="empty" style="display:none">
      Todav√≠a no hay dibujos.<br><br>
      Toc√° <b>‚ÄúAgregar dibujo‚Äù</b> y sac√° una foto del dibujo (ideal con buena luz).
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <input id="file" type="file" accept="image/*" capture="environment" hidden>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modalCard">
      <div class="modalTop">
        <div class="t" id="modalTitle">Dibujo</div>
        <button class="closeBtn" id="closeBtn">Cerrar ‚úñ</button>
      </div>
      <img class="big" id="modalImg" alt="Dibujo ampliado">
    </div>
  </div>

<script>
const LS_KEY = "martu_dibujos_v1";

const grid = document.getElementById("grid");
const empty = document.getElementById("empty");
const count = document.getElementById("count");

const addBtn = document.getElementById("addBtn");
const exportBtn = document.getElementById("exportBtn");
const clearBtn = document.getElementById("clearBtn");

const file = document.getElementById("file");

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
const modalTitle = document.getElementById("modalTitle");
const closeBtn = document.getElementById("closeBtn");

let dibujos = load();

function load(){
  try{
    return JSON.parse(localStorage.getItem(LS_KEY) || "[]");
  }catch(e){
    return [];
  }
}
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(dibujos));
}
function updateCount(){
  count.textContent = `${dibujos.length} dibujo${dibujos.length===1?"":"s"}`;
}
function showEmpty(){
  empty.style.display = dibujos.length ? "none" : "block";
}

function render(){
  grid.innerHTML = "";
  updateCount();
  showEmpty();

  dibujos.forEach((d, idx) => {
    const card = document.createElement("div");
    card.className = "card";

    const title = d.title || `Dibujo ${dibujos.length - idx}`;
    const date = d.date ? new Date(d.date).toLocaleString("es-AR", { dateStyle:"short", timeStyle:"short" }) : "";

    card.innerHTML = `
      <img class="thumb" src="${d.data}" alt="${title}">
      <div class="meta">
        <p class="title">${title}</p>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="smallbtn" data-action="rename" data-idx="${idx}">‚úèÔ∏è</button>
          <button class="smallbtn del" data-action="del" data-idx="${idx}">üóë</button>
        </div>
      </div>
    `;

    const img = card.querySelector(".thumb");
    img.addEventListener("click", () => openModal(title, d.data));

    card.querySelectorAll("button").forEach(b => {
      b.addEventListener("click", () => {
        const action = b.getAttribute("data-action");
        const i = Number(b.getAttribute("data-idx"));
        if(action === "del") delOne(i);
        if(action === "rename") renameOne(i);
      });
    });

    grid.appendChild(card);
  });
}

addBtn.addEventListener("click", () => file.click());

file.addEventListener("change", async (e) => {
  const f = e.target.files?.[0];
  if(!f) return;

  // Convert to dataURL (se guarda en el celu/navegador)
  const data = await toDataURL(f);

  // Title r√°pido
  const title = prompt("Nombre del dibujo (opcional):", "");
  dibujos.unshift({
    title: (title || "").trim() || null,
    date: new Date().toISOString(),
    data
  });

  // L√≠mite simple para evitar que explote (iPhone tiene l√≠mite de almacenamiento)
  if(dibujos.length > 200) dibujos = dibujos.slice(0, 200);

  save();
  render();
  file.value = "";
});

function toDataURL(file){
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

function delOne(i){
  if(!confirm("¬øEliminar este dibujo?")) return;
  dibujos.splice(i,1);
  save();
  render();
}

function renameOne(i){
  const cur = dibujos[i]?.title || "";
  const next = prompt("Nuevo nombre:", cur);
  if(next === null) return;
  dibujos[i].title = next.trim() || null;
  save();
  render();
}

clearBtn.addEventListener("click", () => {
  if(!confirm("¬øBorrar toda la biblioteca?")) return;
  dibujos = [];
  save();
  render();
});

exportBtn.addEventListener("click", () => {
  // Exporta un archivo .json con todos los dibujos (backup)
  const blob = new Blob([JSON.stringify(dibujos, null, 2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "biblioteca-dibujos-backup.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(() => URL.revokeObjectURL(url), 1000);
});

// Modal
function openModal(title, src){
  modalTitle.textContent = title || "Dibujo";
  modalImg.src = src;
  modal.classList.add("open");
  modal.setAttribute("aria-hidden","false");
}
function closeModal(){
  modal.classList.remove("open");
  modal.setAttribute("aria-hidden","true");
  modalImg.src = "";
}
closeBtn.addEventListener("click", closeModal);
modal.addEventListener("click", (e) => { if(e.target === modal) closeModal(); });
document.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

// Start
render();
</script>
</body>
</html>