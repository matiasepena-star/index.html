<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Martu-art ¬∑ Expos + Dibujos</title>
  <style>
    :root{
      --bg:#0f1115;
      --stroke:rgba(255,255,255,.10);
      --text:#e8ecf6;
      --muted:rgba(232,236,246,.62);
      --brand:#7aa2ff;
      --good:#44d07b;
      --bad:#ff5b6b;
      --shadow: 0 14px 40px rgba(0,0,0,.55);
      --r:18px;
      --press: translateY(1px) scale(.99);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1000px 600px at 20% -10%, rgba(122,162,255,.25), transparent 55%),
                  radial-gradient(900px 600px at 90% 0%, rgba(68,208,123,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:14px 12px 80px}
    .hero{
      display:flex; gap:14px; align-items:center;
      padding:14px; border:1px solid var(--stroke);
      border-radius:24px; background:rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .logo{
      width:54px;height:54px;border-radius:16px;
      background: linear-gradient(135deg, rgba(122,162,255,.85), rgba(122,162,255,.25));
      border:1px solid rgba(255,255,255,.14);
    }
    .hero h1{margin:0;font-size:22px;line-height:1.05}
    .sub{margin:4px 0 0;color:var(--muted);font-size:13px}
    .pill{
      margin-left:auto;
      padding:10px 14px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      display:flex;align-items:center;gap:10px;
      min-width:230px; justify-content:center;
      text-align:center;
    }
    .dot{width:10px;height:10px;border-radius:999px;background:var(--bad);box-shadow:0 0 0 4px rgba(255,91,107,.18)}
    .pill.ok .dot{background:var(--good);box-shadow:0 0 0 4px rgba(68,208,123,.18)}
    .pill strong{font-size:14px}
    .pill span{display:block;color:var(--muted);font-size:12px;margin-top:2px}
    .tabs{
      margin-top:14px;
      display:flex; gap:12px;
    }
    .tabBtn{
      flex:1;
      padding:14px 12px;
      border-radius:20px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight:700;
      display:flex; align-items:center; justify-content:center;
      gap:10px;
      box-shadow: 0 10px 28px rgba(0,0,0,.35);
      cursor:pointer;
      user-select:none;
    }
    .tabBtn:active{transform:var(--press)}
    .tabBtn.active{
      border-color: rgba(122,162,255,.45);
      background: rgba(122,162,255,.12);
    }
    .panel{
      margin-top:14px;
      padding:16px;
      border-radius:24px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .hint{color:var(--muted);line-height:1.35;margin:0 0 12px}
    label{display:block;color:var(--muted);font-size:13px;margin:12px 0 8px}
    input, select{
      width:100%;
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: var(--text);
      outline:none;
      font-size:16px;
    }
    input::placeholder{color: rgba(232,236,246,.35)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1;min-width:160px}
    .btn{
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(122,162,255,.14);
      color: var(--text);
      font-weight:800;
      cursor:pointer;
      user-select:none;
      text-align:center;
    }
    .btn.secondary{background: rgba(255,255,255,.06)}
    .btn:active{transform:var(--press)}
    .statBox{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .stat{
      padding:12px 14px;
      border:1px solid var(--stroke);
      border-radius:18px;
      background: rgba(255,255,255,.03);
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .stat b{color:var(--text)}
    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: repeat(4, 1fr)}
    }
    .card{
      border-radius:18px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      overflow:hidden;
      cursor:pointer;
      user-select:none;
      position:relative;
    }
    .thumb{
      width:100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      display:block;
      background: rgba(0,0,0,.25);
    }
    .cap{
      padding:10px 12px;
      color: var(--muted);
      font-size:12px;
      border-top:1px solid rgba(255,255,255,.08);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .footer{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background: rgba(0,0,0,.42);
      border-top:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(12px);
      font-size:12px;
      color: var(--muted);
      display:flex; justify-content:space-between; gap:10px;
    }
    .toast{
      position:fixed;
      left:50%;
      bottom:64px;
      transform:translateX(-50%);
      padding:12px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.65);
      color: var(--text);
      display:none;
      align-items:center;
      gap:10px;
      max-width:min(92vw,560px);
      box-shadow: var(--shadow);
    }
    .toast.show{display:flex}
    .toast .x{
      margin-left:auto;
      opacity:.75;
      font-weight:900;
      cursor:pointer;
      padding:0 6px;
    }
    /* Modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.72);
      display:none;
      align-items:center; justify-content:center;
      padding:14px;
      z-index:50;
    }
    .modal.show{display:flex}
    .modalBox{
      width:min(92vw, 920px);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(12px);
      overflow:hidden;
      position:relative;
    }
    .modalTop{
      position:absolute;
      top:10px; left:10px;
      padding:8px 10px;
      border-radius:14px;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
      font-size:12px;
      display:flex; gap:10px; align-items:center;
      z-index:2;
    }
    .modalTop button{
      border:0; background:transparent; color:var(--text);
      font-weight:900; cursor:pointer;
      padding:2px 6px; border-radius:10px;
    }
    .modalTop button:active{transform:var(--press)}
    .modalImg{
      width:100%;
      height:auto;
      display:block;
      max-height: 84vh;
      object-fit:contain;
      background: rgba(0,0,0,.3);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Martu-art</h1>
        <div class="sub">Expos + Dibujos (GitHub Pages + Supabase Storage)</div>
      </div>
      <div class="pill" id="pill">
        <div class="dot"></div>
        <div>
          <strong id="statusTitle">Conectando‚Ä¶</strong>
          <span id="statusMsg">probando Storage</span>
        </div>
      </div>
    </div>

    <div class="tabs">
      <div class="tabBtn active" id="tabExpos">üìÅ Expos</div>
      <div class="tabBtn" id="tabUpload">‚¨ÜÔ∏è Subir dibujo</div>
      <div class="tabBtn" id="tabGallery">üñºÔ∏è Galer√≠a</div>
    </div>

    <!-- EXPO -->
    <div class="panel" id="panelExpos">
      <p class="hint">
        Esto usa <b>solo Storage</b> (sin DB y sin librer√≠as externas). Menos magia, m√°s funciona.
      </p>

      <label>Nombre de la expo</label>
      <input id="expoName" placeholder="Ej: Primavera 2026, Dinosaurios, etc."/>

      <label>Slug (se autogenera)</label>
      <input id="expoSlug" placeholder="ej: primavera-2026" disabled/>

      <div class="row" style="margin-top:12px">
        <div class="btn" id="btnCreateExpo">Crear expo</div>
        <div class="btn secondary" id="btnRefresh">Actualizar lista</div>
      </div>

      <label style="margin-top:16px">Expo seleccionada</label>
      <select id="expoSelect">
        <option value="">‚Äî Eleg√≠ una expo ‚Äî</option>
      </select>

      <label>Link de la expo (para compartir)</label>
      <input id="expoLink" placeholder="Se completa al elegir una expo" readonly/>
      <div class="row" style="margin-top:10px">
        <div class="btn secondary" id="btnCopyLink">Copiar link</div>
      </div>

      <div class="statBox">
        <div class="stat"><span>Expos creadas</span> <b id="countExpos">0</b></div>
        <div class="stat"><span>Dibujos en esta expo</span> <b id="countFiles">0</b></div>
      </div>
    </div>

    <!-- UPLOAD -->
    <div class="panel" id="panelUpload" style="display:none">
      <p class="hint">Sub√≠ una foto del dibujo (jpg/png). Se guarda en el bucket y queda dentro de la expo seleccionada.</p>

      <label>Expo (obligatorio)</label>
      <select id="uploadExpoSelect">
        <option value="">‚Äî Eleg√≠ una expo ‚Äî</option>
      </select>

      <label>Archivo (foto del dibujo)</label>
      <input id="fileInput" type="file" accept="image/*" />

      <label>T√≠tulo (opcional)</label>
      <input id="titleInput" placeholder="Ej: Gatito, Arcoiris, etc."/>

      <div class="row" style="margin-top:12px">
        <div class="btn" id="btnUpload">Subir</div>
        <div class="btn secondary" id="btnGoGallery">Ver galer√≠a</div>
      </div>
    </div>

    <!-- GALLERY -->
    <div class="panel" id="panelGallery" style="display:none">
      <p class="hint">Eleg√≠ una expo y mir√° los dibujos. Toc√° una imagen para agrandar.</p>

      <label>Expo</label>
      <select id="galleryExpoSelect">
        <option value="">‚Äî Eleg√≠ una expo ‚Äî</option>
      </select>

      <div class="row" style="margin-top:12px">
        <div class="btn secondary" id="btnLoadGallery">Cargar galer√≠a</div>
      </div>

      <div style="height:12px"></div>
      <div class="grid" id="grid"></div>
    </div>
  </div>

  <div class="footer">
    <div>Estado: <b id="footState">‚Äî</b></div>
    <div>bucket: <b id="footBucket">‚Äî</b></div>
  </div>

  <div class="toast" id="toast">
    <div id="toastMsg">‚Äî</div>
    <div class="x" id="toastX">√ó</div>
  </div>

  <div class="modal" id="modal">
    <div class="modalBox">
      <div class="modalTop">
        <div>Toc√° para agrandar</div>
        <button id="modalClose">Cerrar</button>
      </div>
      <img id="modalImg" class="modalImg" alt="Imagen"/>
    </div>
  </div>

  <script>
    // ===========================
    // 1) CONFIG (TOC√Å SOLO ESTO)
    // ===========================
    const SUPABASE_URL = "https://vfvbssenzfbrnkyddyo.supabase.co"; // si tu Project ID es otro, cambialo ac√°
    const SUPABASE_ANON_KEY = "sb_publishable__3wLx8HB6dbL49gWL9Eyfw_kJPFh6kS";
    const BUCKET = "drawings";
    const EXPO_INDEX_PATH = "_expos.json"; // archivo √≠ndice en el root del bucket

    // ===========================
    // 2) Helpers
    // ===========================
    const $ = (id)=>document.getElementById(id);

    const toast = (msg, bad=false)=>{
      $("toastMsg").textContent = msg;
      $("toastMsg").style.color = bad ? "var(--bad)" : "var(--text)";
      $("toast").classList.add("show");
      clearTimeout(window.__toastT);
      window.__toastT = setTimeout(()=>$("toast").classList.remove("show"), 2600);
    };
    $("toastX").onclick = ()=>$("toast").classList.remove("show");

    const setStatus = (ok, title, msg)=>{
      const pill = $("pill");
      pill.classList.toggle("ok", !!ok);
      $("statusTitle").textContent = title;
      $("statusMsg").textContent = msg || "";
      $("footState").textContent = ok ? "ok" : "error";
      $("footBucket").textContent = BUCKET;
    };

    const slugify = (s)=>{
      return (s||"")
        .toString()
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
        .trim().toLowerCase()
        .replace(/[^a-z0-9]+/g,"-")
        .replace(/(^-|-$)/g,"");
    };

    const headersAuth = ()=>{
      return {
        "apikey": SUPABASE_ANON_KEY,
        "Authorization": "Bearer " + SUPABASE_ANON_KEY
      };
    };

    const storageObjectURL = (path)=>{
      // Public URL (sirve si el bucket es PUBLIC). Si no es public, igual sube pero no se ve.
      return `${SUPABASE_URL}/storage/v1/object/public/${encodeURIComponent(BUCKET)}/${path.split("/").map(encodeURIComponent).join("/")}`;
    };

    async function storageList(prefix){
      // POST /storage/v1/object/list/{bucket}
      const url = `${SUPABASE_URL}/storage/v1/object/list/${encodeURIComponent(BUCKET)}`;
      const res = await fetch(url, {
        method:"POST",
        headers: {
          ...headersAuth(),
          "Content-Type":"application/json"
        },
        body: JSON.stringify({
          prefix: prefix || "",
          limit: 1000,
          offset: 0,
          sortBy: { column: "name", order: "asc" }
        })
      });
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`LIST ${res.status}: ${t || res.statusText}`);
      }
      return res.json();
    }

    async function storageUpload(path, fileOrBlob, contentType){
      const url = `${SUPABASE_URL}/storage/v1/object/${encodeURIComponent(BUCKET)}/${path.split("/").map(encodeURIComponent).join("/")}`;
      const res = await fetch(url, {
        method:"POST",
        headers: {
          ...headersAuth(),
          "Content-Type": contentType || "application/octet-stream",
          "x-upsert": "true"
        },
        body: fileOrBlob
      });
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`UPLOAD ${res.status}: ${t || res.statusText}`);
      }
      return res.json();
    }

    async function storageDownload(path){
      const url = `${SUPABASE_URL}/storage/v1/object/${encodeURIComponent(BUCKET)}/${path.split("/").map(encodeURIComponent).join("/")}`;
      const res = await fetch(url, { headers: headersAuth() });
      if(res.status === 404) return null;
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`GET ${res.status}: ${t || res.statusText}`);
      }
      return res.json();
    }

    async function storagePutJSON(path, obj){
      const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
      const url = `${SUPABASE_URL}/storage/v1/object/${encodeURIComponent(BUCKET)}/${path.split("/").map(encodeURIComponent).join("/")}`;
      const res = await fetch(url, {
        method:"PUT",
        headers: {
          ...headersAuth(),
          "Content-Type":"application/json",
          "x-upsert":"true"
        },
        body: blob
      });
      if(!res.ok){
        const t = await res.text().catch(()=> "");
        throw new Error(`PUT ${res.status}: ${t || res.statusText}`);
      }
      return res.json();
    }

    function pageLinkForExpo(slug){
      const u = new URL(location.href);
      u.searchParams.set("expo", slug);
      return u.toString();
    }

    // ===========================
    // 3) Expo Index (_expos.json)
    // ===========================
    async function readExpoIndex(){
      try{
        const json = await storageDownload(EXPO_INDEX_PATH);
        if(!json) return [];
        if(Array.isArray(json)) return json;
        if(Array.isArray(json.expos)) return json.expos;
        return [];
      }catch(e){
        // si no hay permiso o no existe, devolvemos vac√≠o
        return [];
      }
    }

    async function writeExpoIndex(expos){
      await storagePutJSON(EXPO_INDEX_PATH, { expos });
    }

    // ===========================
    // 4) UI: Tabs
    // ===========================
    const showTab = (name)=>{
      const tabs = [
        ["Expos","panelExpos","tabExpos"],
        ["Upload","panelUpload","tabUpload"],
        ["Gallery","panelGallery","tabGallery"],
      ];
      tabs.forEach(([n,p,t])=>{
        $(p).style.display = (n===name) ? "" : "none";
        $(t).classList.toggle("active", n===name);
      });
    };

    $("tabExpos").onclick = ()=>showTab("Expos");
    $("tabUpload").onclick = ()=>showTab("Upload");
    $("tabGallery").onclick = ()=>showTab("Gallery");
    $("btnGoGallery").onclick = ()=>{
      showTab("Gallery");
      if($("galleryExpoSelect").value) loadGallery();
    };

    // Modal
    const openModal = (src)=>{
      $("modalImg").src = src;
      $("modal").classList.add("show");
    };
    const closeModal = ()=> $("modal").classList.remove("show");
    $("modal").onclick = (e)=>{ if(e.target.id==="modal") closeModal(); };
    $("modalClose").onclick = closeModal;

    // ===========================
    // 5) Expos / Selects
    // ===========================
    function fillSelects(expos){
      const opts = ['<option value="">‚Äî Eleg√≠ una expo ‚Äî</option>']
        .concat(expos.map(x=>`<option value="${x.slug}">${x.name} (${x.slug})</option>`))
        .join("");

      $("expoSelect").innerHTML = opts;
      $("uploadExpoSelect").innerHTML = opts;
      $("galleryExpoSelect").innerHTML = opts;

      $("countExpos").textContent = String(expos.length);
    }

    async function refreshExpos(){
      const expos = await readExpoIndex();
      fillSelects(expos);

      // si viene ?expo=... lo seleccionamos
      const u = new URL(location.href);
      const qExpo = u.searchParams.get("expo") || "";
      if(qExpo){
        $("expoSelect").value = qExpo;
        $("uploadExpoSelect").value = qExpo;
        $("galleryExpoSelect").value = qExpo;
        $("expoLink").value = pageLinkForExpo(qExpo);
        await updateCountsForExpo(qExpo);
      }else{
        $("expoLink").value = "";
        $("countFiles").textContent = "0";
      }
    }

    async function updateCountsForExpo(slug){
      if(!slug){ $("countFiles").textContent="0"; return; }
      try{
        const list = await storageList(slug + "/");
        const files = (list||[]).filter(x=>x.name && !x.name.endsWith("/.keep") && x.name !== ".keep" && !x.name.endsWith(".keep"));
        $("countFiles").textContent = String(files.length);
      }catch(e){
        $("countFiles").textContent = "‚Äî";
      }
    }

    $("expoName").addEventListener("input", ()=>{
      $("expoSlug").value = slugify($("expoName").value);
    });

    $("btnRefresh").onclick = async ()=>{
      try{
        await refreshExpos();
        toast("Lista actualizada ‚úÖ");
      }catch(e){
        console.error(e);
        toast("No pude actualizar ‚ùå", true);
      }
    };

    $("expoSelect").onchange = async ()=>{
      const slug = $("expoSelect").value || "";
      $("uploadExpoSelect").value = slug;
      $("galleryExpoSelect").value = slug;
      $("expoLink").value = slug ? pageLinkForExpo(slug) : "";
      await updateCountsForExpo(slug);
    };

    $("btnCopyLink").onclick = async ()=>{
      const v = $("expoLink").value.trim();
      if(!v){ toast("Eleg√≠ una expo primero", true); return; }
      try{
        await navigator.clipboard.writeText(v);
        toast("Link copiado ‚úÖ");
      }catch{
        toast("No pude copiar (iPhone a veces se hace el dif√≠cil) ‚ùå", true);
      }
    };

    // Crear expo = agrega en _expos.json + crea placeholder .keep
    $("btnCreateExpo").onclick = async ()=>{
      const name = $("expoName").value.trim();
      const slug = slugify(name);

      if(!name){ toast("Pon√© un nombre de expo", true); return; }
      if(!slug){ toast("Nombre inv√°lido", true); return; }

      try{
        const expos = await readExpoIndex();
        if(expos.some(x=>x.slug === slug)){
          toast("Esa expo ya existe", true);
          $("expoSelect").value = slug;
          $("uploadExpoSelect").value = slug;
          $("galleryExpoSelect").value = slug;
          $("expoLink").value = pageLinkForExpo(slug);
          await updateCountsForExpo(slug);
          return;
        }

        expos.push({ name, slug, created_at: new Date().toISOString() });
        await writeExpoIndex(expos);

        // placeholder para ‚Äúcrear carpeta‚Äù
        const empty = new Blob([""], {type:"text/plain"});
        await storageUpload(`${slug}/.keep`, empty, "text/plain");

        await refreshExpos();
        $("expoSelect").value = slug;
        $("uploadExpoSelect").value = slug;
        $("galleryExpoSelect").value = slug;
        $("expoLink").value = pageLinkForExpo(slug);
        await updateCountsForExpo(slug);

        toast("Expo creada ‚úÖ");
      }catch(e){
        console.error(e);
        toast("No pudo crear expo ‚ùå", true);
      }
    };

    // ===========================
    // 6) Upload
    // ===========================
    $("btnUpload").onclick = async ()=>{
      const slug = $("uploadExpoSelect").value || "";
      const file = $("fileInput").files && $("fileInput").files[0];
      const title = $("titleInput").value.trim();

      if(!slug){ toast("Eleg√≠ una expo", true); return; }
      if(!file){ toast("Eleg√≠ una foto", true); return; }

      try{
        const safeTitle = slugify(title).slice(0, 40);
        const ext = (file.name.split(".").pop() || "jpg").toLowerCase();
        const ts = new Date().toISOString().replace(/[:.]/g,"-");
        const rnd = Math.random().toString(16).slice(2,8);
        const filename = `${ts}_${rnd}${safeTitle ? "_" + safeTitle : ""}.${ext}`;
        const path = `${slug}/${filename}`;

        await storageUpload(path, file, file.type || "application/octet-stream");

        toast("Subi√≥ ‚úÖ");
        $("fileInput").value = "";
        $("titleInput").value = "";
        await updateCountsForExpo(slug);
      }catch(e){
        console.error(e);
        toast("No subi√≥ ‚ùå", true);
      }
    };

    // ===========================
    // 7) Gallery
    // ===========================
    async function loadGallery(){
      const slug = $("galleryExpoSelect").value || "";
      if(!slug){ toast("Eleg√≠ una expo", true); return; }

      try{
        const list = await storageList(slug + "/");
        const items = (list||[])
          .map(x=>x.name)
          .filter(name => name && name !== ".keep" && !name.endsWith("/.keep") && !name.endsWith(".keep"))
          .map(name => ({
            path: `${slug}/${name}`.replace(/\/+/g,"/"),
            name
          }));

        $("grid").innerHTML = "";

        if(items.length === 0){
          $("grid").innerHTML = `<div style="color:var(--muted);padding:10px 2px">No hay dibujos todav√≠a.</div>`;
          return;
        }

        items.forEach(it=>{
          const src = storageObjectURL(it.path);
          const el = document.createElement("div");
          el.className = "card";
          el.innerHTML = `
            <img class="thumb" loading="lazy" src="${src}" alt="dibujo"/>
            <div class="cap">${it.name}</div>
          `;
          el.onclick = ()=>openModal(src);
          $("grid").appendChild(el);
        });

        toast("Galer√≠a cargada ‚úÖ");
      }catch(e){
        console.error(e);
        toast("Error cargando galer√≠a ‚ùå", true);
      }
    }

    $("btnLoadGallery").onclick = loadGallery;

    // ===========================
    // 8) Boot
    // ===========================
    async function boot(){
      $("footBucket").textContent = BUCKET;

      if(!SUPABASE_URL.includes("supabase.co")){
        setStatus(false, "Error", "Falta SUPABASE_URL");
        toast("Falta SUPABASE_URL", true);
        return;
      }

      try{
        // prueba r√°pida de auth/list
        await storageList("");
        setStatus(true, "Conectado ‚úÖ", "");
        await refreshExpos();
      }catch(e){
        console.error(e);
        setStatus(false, "Error", "No pude hablar con Storage");
        toast("Error (permisos o bucket no p√∫blico)", true);
      }
    }

    boot();
  </script>
</body>
</html>