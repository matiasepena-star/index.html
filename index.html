<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Martu-art</title>

<style>
:root{
--bg:#0f1115;
--stroke:rgba(255,255,255,.10);
--text:#e8ecf6;
--muted:rgba(232,236,246,.62);
--brand:#7aa2ff;
--good:#44d07b;
--bad:#ff5b6b;
--shadow:0 18px 50px rgba(0,0,0,.55);
--press:translateY(2px) scale(.985);
}
*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui;
background:var(--bg);
color:var(--text);
}
.wrap{max-width:900px;margin:0 auto;padding:16px}
.card{
background:rgba(20,24,34,.9);
border:1px solid var(--stroke);
border-radius:20px;
padding:20px;
box-shadow:var(--shadow);
}
h1{margin:0 0 10px 0}
.btn{
border:1px solid var(--stroke);
background:rgba(122,162,255,.15);
color:var(--text);
border-radius:14px;
padding:12px;
font-weight:700;
cursor:pointer;
transition:.1s;
}
.btn:active{transform:var(--press)}
select,input{width:100%;padding:10px;margin:8px 0;background:#111;border:1px solid var(--stroke);color:#fff;border-radius:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;margin-top:20px}
.imgCard{border:1px solid var(--stroke);border-radius:14px;overflow:hidden;background:#111}
.imgCard img{width:100%;height:200px;object-fit:cover}
.imgCard .meta{padding:8px;font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="wrap">
<div class="card">
<h1>Martu-art</h1>

<label>Expo</label>
<select id="expoSelect">
<option value="">— Elegí una expo —</option>
</select>

<button class="btn" id="btnLoad">Cargar galería</button>

<div id="gallery" class="grid"></div>
</div>
</div>

<script>
const SUPABASE_URL="https://vfvbssenzfbrnkydddxo.supabase.co";
const SUPABASE_KEY="sb_publishable__3wLx8HB6dbL49gWL9Eyfw_kJPFh6kS";
const BUCKET="drawings";

const API=`${SUPABASE_URL}/storage/v1`;

async function sbFetch(path,opts={}){
const headers=new Headers(opts.headers||{});
headers.set("apikey",SUPABASE_KEY);
headers.set("authorization",`Bearer ${SUPABASE_KEY}`);
return fetch(`${API}${path}`,{...opts,headers});
}

async function listAll(prefix=""){
const res=await sbFetch(`/object/list/${BUCKET}`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({prefix,limit:1000})
});
return res.json();
}

function publicUrl(path){
return `${SUPABASE_URL}/storage/v1/object/public/${BUCKET}/${path.split("/").map(encodeURIComponent).join("/")}`;
}

async function loadExpos(){
const objs=await listAll("");
const set=new Set();
objs.forEach(o=>{
const name=o.name||"";
if(name.includes("/")){
set.add(name.split("/")[0]);
}
});
const sel=document.getElementById("expoSelect");
set.forEach(s=>{
const op=document.createElement("option");
op.value=s;
op.textContent=s;
sel.appendChild(op);
});
}

async function loadGallery(){
const slug=document.getElementById("expoSelect").value;
if(!slug)return;
const objs=await listAll(slug+"/");
const grid=document.getElementById("gallery");
grid.innerHTML="";
objs.forEach(o=>{
if(!o.name.endsWith(".jpg") && !o.name.endsWith(".png") && !o.name.endsWith(".jpeg"))return;
const url=publicUrl(o.name)+"?v="+Date.now();
const card=document.createElement("div");
card.className="imgCard";
card.innerHTML=`<img src="${url}"><div class="meta">${o.name.split("/").pop()}</div>`;
grid.appendChild(card);
});
}

document.getElementById("btnLoad").onclick=loadGallery;

loadExpos();
</script>

</body>
</html>